import{d as Y,z as h,ah as R,az as b,ap as y,aA as z,a3 as w,l as S,o as B,f as T,w as d,b as t,u as s,J as _,a6 as f,a5 as U,S as H,aB as $,M as O,C as Z,a9 as j,ad as Q,D as G,aC as J,aD as L,aj as K,_ as W}from"./index-59vPsdGi.js";/* empty css                *//* empty css                  */import{r as P}from"./index-Wt3bBo4a.js";const X=Y({__name:"index",setup(k){const v=h("first");R(()=>{I()});const I=()=>{const l=b();a.username=l.attributes.username,a.shortId=l.attributes.shortId,a.avatar=l.attributes.avatar,a.mobilePhoneNumber=l.attributes.mobilePhoneNumber,a.email=l.attributes.email,a.createdAt=y(l.createdAt).format("YYYY-MM-DD HH:mm:ss"),a.updatedAt=y(l.updatedAt).format("YYYY-MM-DD HH:mm:ss"),z(l.attributes.role).then(e=>{a.role=e})};let g=h(),a=w({username:"",shortId:"",avatar:"",mobilePhoneNumber:"",email:"",role:"",createdAt:"",updatedAt:""}),A=w({username:[{required:!0,message:"Please input the username",trigger:"blur"},{validator:(l,e,r)=>{P().then(o=>{const u=b();o.find(i=>i.attributes.username===e&&i.attributes.username!==u.attributes.username)?r(new Error("用户名已存在")):e.trim().length<5?r(new Error("用户名长度至少五位")):r()})},trigger:"blur"}],shortId:[{validator:(l,e,r)=>{P().then(o=>{const u=b();e===""?r():o.find(i=>i.attributes.shortId===e&&i.attributes.shortId!==u.attributes.shortId)?r(new Error("昵称已存在")):e.trim().length<2?r(new Error("昵称长度至少两位")):r()})},trigger:"blur"}],mobilePhoneNumber:[{validator:(l,e,r)=>{P().then(o=>{const u=b(),i=/^1[3456789]\d{9}$/;e===""?r():o.find(p=>p.attributes.mobilePhoneNumber===e&&p.attributes.mobilePhoneNumber!==u.attributes.mobilePhoneNumber)?r(new Error("手机号码已存在")):i.test(e)?r():r(new Error("请输入有效的手机号码"))})},trigger:"blur"}],email:[{validator:(l,e,r)=>{P().then(o=>{const u=b(),i=/^[A-Za-z0-9\u4e00-\u9fa5]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/;e===""?r():o.find(p=>p.attributes.email===e&&p.attributes.email!==u.attributes.email)?r(new Error("邮箱已存在")):i.test(e)?r():r(new Error("请输入有效的邮箱"))})},trigger:"blur"}]});const N=async l=>{l&&await l.validate(e=>{if(e){const r=b();r?(r.setUsername(a.username),r.setEmail(a.email),r.setMobilePhoneNumber(a.mobilePhoneNumber),r.set("shortId",a.shortId),r.save().then(()=>{f({title:"保存成功",type:"success"})},o=>{f({title:"保存失败",type:"error",message:o.code+" "+o})})):f({title:"保存失败",type:"error",message:"current is null"})}else f({title:"表单校验失败",type:"error"})})},C=()=>{var l;(l=g.value)==null||l.clearValidate(),I()},c=S();let V=h(),m=w({oldPassword:"",newPassword:"",confirmPassword:""}),x=w({oldPassword:[{required:!0,message:"Please input the old password",trigger:"blur"},{validator:(l,e,r)=>{e!==U(c.lk)?r(new Error("旧密码错误")):r()},trigger:"blur"}],newPassword:[{required:!0,message:"Please input the new password",trigger:"blur"},{validator:(l,e,r)=>{e.trim().length<5?r(new Error("密码长度至少五位")):e===U(c.lk)?r(new Error("新密码不能与旧密码相同")):r()},trigger:"blur"}],confirmPassword:[{required:!0,message:"Please input the new password again",trigger:"blur"},{validator:(l,e,r)=>{e!==m.newPassword?r(new Error("Two inputs don't match!")):r()},trigger:"blur"}]});const M=async l=>{l&&await l.validate(e=>{if(e){const r=b();r?(r.setPassword(m.newPassword),r.save().then(()=>{f({title:"修改成功",type:"success",message:"请重新登录"}),H(()=>{c.userLogout(),$.push("/account/login")})},o=>{f({title:"保存失败",type:"error",message:o.code+" "+o})})):f({title:"保存失败",type:"error",message:"current is null"})}else f({title:"表单校验失败",type:"error"})})},q=()=>{var l;(l=V.value)==null||l.clearValidate(),Object.assign(m,{oldPassword:"",newPassword:"",confirmPassword:""})};return(l,e)=>{const r=O,o=Z,u=j,i=Q,p=G,E=J,D=L,F=K;return B(),T(F,null,{default:d(()=>[t(D,{modelValue:v.value,"onUpdate:modelValue":e[12]||(e[12]=n=>v.value=n)},{default:d(()=>[t(E,{label:"基本资料",name:"first"},{default:d(()=>[t(p,{ref_key:"userInfoFormRef",ref:g,"label-width":"80px",model:s(a),rules:s(A)},{default:d(()=>[t(o,{label:"用户头像"},{default:d(()=>[t(r,{shape:"square",size:150,src:s(a).avatar},null,8,["src"])]),_:1}),t(o,{label:"账号名称",prop:"username"},{default:d(()=>[t(u,{modelValue:s(a).username,"onUpdate:modelValue":e[0]||(e[0]=n=>s(a).username=n),placeholder:"请输入账号名称",clearable:""},null,8,["modelValue"])]),_:1}),t(o,{label:"账号昵称",prop:"shortId"},{default:d(()=>[t(u,{modelValue:s(a).shortId,"onUpdate:modelValue":e[1]||(e[1]=n=>s(a).shortId=n),placeholder:"请输入账号昵称",clearable:""},null,8,["modelValue"])]),_:1}),t(o,{label:"手机号码",prop:"mobilePhoneNumber"},{default:d(()=>[t(u,{modelValue:s(a).mobilePhoneNumber,"onUpdate:modelValue":e[2]||(e[2]=n=>s(a).mobilePhoneNumber=n),placeholder:"请输入手机号码",clearable:""},null,8,["modelValue"])]),_:1}),t(o,{label:"电子邮箱",prop:"email"},{default:d(()=>[t(u,{modelValue:s(a).email,"onUpdate:modelValue":e[3]||(e[3]=n=>s(a).email=n),placeholder:"请输入电子邮箱",clearable:""},null,8,["modelValue"])]),_:1}),t(o,{label:"所属角色",prop:"role"},{default:d(()=>[t(u,{modelValue:s(a).role,"onUpdate:modelValue":e[4]||(e[4]=n=>s(a).role=n),clearable:"",disabled:""},null,8,["modelValue"])]),_:1}),t(o,{label:"创建日期",prop:"createdAt"},{default:d(()=>[t(u,{modelValue:s(a).createdAt,"onUpdate:modelValue":e[5]||(e[5]=n=>s(a).createdAt=n),clearable:"",disabled:""},null,8,["modelValue"])]),_:1}),t(o,{label:"修改日期",prop:"createdAt"},{default:d(()=>[t(u,{modelValue:s(a).updatedAt,"onUpdate:modelValue":e[6]||(e[6]=n=>s(a).updatedAt=n),clearable:"",disabled:""},null,8,["modelValue"])]),_:1}),t(o,null,{default:d(()=>[t(i,{type:"primary",plain:"",onClick:e[7]||(e[7]=n=>N(s(g)))},{default:d(()=>[_(" 保存 ")]),_:1}),t(i,{type:"danger",plain:"",onClick:C},{default:d(()=>[_(" 重置 ")]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1}),t(E,{label:"修改密码",name:"second"},{default:d(()=>[t(p,{ref_key:"passwordFormRef",ref:V,"label-width":"80px",model:s(m),rules:s(x)},{default:d(()=>[t(o,{label:"旧密码",prop:"oldPassword"},{default:d(()=>[t(u,{modelValue:s(m).oldPassword,"onUpdate:modelValue":e[8]||(e[8]=n=>s(m).oldPassword=n),placeholder:"请输入旧密码","show-password":"",clearable:""},null,8,["modelValue"])]),_:1}),t(o,{label:"新密码",prop:"newPassword"},{default:d(()=>[t(u,{modelValue:s(m).newPassword,"onUpdate:modelValue":e[9]||(e[9]=n=>s(m).newPassword=n),placeholder:"请输入新密码","show-password":"",clearable:""},null,8,["modelValue"])]),_:1}),t(o,{label:"确认密码",prop:"confirmPassword"},{default:d(()=>[t(u,{modelValue:s(m).confirmPassword,"onUpdate:modelValue":e[10]||(e[10]=n=>s(m).confirmPassword=n),placeholder:"请输入确认密码","show-password":"",clearable:""},null,8,["modelValue"])]),_:1}),t(o,null,{default:d(()=>[t(i,{type:"primary",plain:"",onClick:e[11]||(e[11]=n=>M(s(V)))},{default:d(()=>[_(" 保存 ")]),_:1}),t(i,{type:"danger",plain:"",onClick:q},{default:d(()=>[_(" 重置 ")]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1})]),_:1},8,["modelValue"])]),_:1})}}}),me=W(X,[["__scopeId","data-v-ca8610ee"]]);export{me as default};
