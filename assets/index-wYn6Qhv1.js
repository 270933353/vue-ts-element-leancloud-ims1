import{d as se,z as v,m as E,ah as ne,ap as h,L as m,a3 as z,ai as de,o as f,c as H,b as t,w as o,u as s,A as V,J as g,x as C,f as I,a as q,t as ue,e as ie,F as pe,g as ce,az as me,S as B,a9 as be,C as ve,ad as fe,D as ge,aj as _e,at as ye,aE as we,aw as he,ax as Ie,as as Ve,G as Ue,aF as Ce,ar as Ye,_ as Ae}from"./index-59vPsdGi.js";import{u as xe}from"./el-drawer-4jTvGZza.js";/* empty css                      *//* empty css                        *//* empty css                   *//* empty css                */import{r as je,a as De,b as ke,c as Se,d as Me}from"./index-Wt3bBo4a.js";import{a as Ee,b as ze,e as He}from"./validator-qMdRg1PI.js";const qe={style:{flex:"auto"}},Be=se({__name:"index",setup(Pe){let _=v([]),x=v([]),i=v(1),y=v(10),P=E(()=>_.value.length);const N=E(()=>{const a=(i.value-1)*y.value,e=a+y.value;return console.log("data1",_),_.value.slice(a,e)});ne(()=>{Y()});const j=a=>{const e=me();return!(e&&a===e.id)},Y=async()=>{await je().then(a=>{_.value=a.map(e=>({...e.attributes,objectId:e.id,createdAt:h(e.createdAt).format("YYYY-MM-DD HH:mm:ss"),updatedAt:h(e.updatedAt).format("YYYY-MM-DD HH:mm:ss")}))},a=>{m({type:"error",message:"获取全部用户信息失败 "+a})})},D=async()=>{await Ce().then(a=>{x.value=a.map(e=>({...e.attributes,objectId:e.id,createdAt:h(e.createdAt).format("YYYY-MM-DD HH:mm:ss"),updatedAt:h(e.updatedAt).format("YYYY-MM-DD HH:mm:ss")}),e=>{m({type:"error",message:"获取全部角色信息失败 "+e})})})},O=a=>{i.value=a},L=a=>{y.value=a};let r=v(),u=v(!1),n=z({objectId:"",username:"",password:"",shortId:"",role:""});const T=z({username:[{required:!1,trigger:"blur",validator:Ee}],password:[{required:!1,trigger:"blur",validator:ze}],shortId:[{required:!1,trigger:"blur",validator:He}]}),K=()=>{D(),u.value=!0,Object.assign(n,{objectId:"",username:"",password:"",shortId:"",role:""}),B(()=>{var a,e,d,p;(a=r==null?void 0:r.value)==null||a.clearValidate("username"),(e=r==null?void 0:r.value)==null||e.clearValidate("password"),(d=r==null?void 0:r.value)==null||d.clearValidate("shortId"),(p=r==null?void 0:r.value)==null||p.clearValidate("role")})},Q=a=>{D(),u.value=!0,Object.assign(n,a),B(()=>{var e,d,p;(e=r==null?void 0:r.value)==null||e.clearValidate("username"),(d=r==null?void 0:r.value)==null||d.clearValidate("shortId"),(p=r==null?void 0:r.value)==null||p.clearValidate("role")})},G=async a=>{await De(a).then(()=>{u.value=!1,m({type:"success",message:"删除成功"}),Y(),i.value=_.value.length>1?i.value:i.value-1},e=>{u.value=!1,m({type:"error",message:"删除失败 "+e})})};let A=v([]);const $=a=>{A.value=a},J=async()=>{let a=A.value.map(e=>e.objectId);await ke(a).then(e=>{console.log(e),m({type:"success",message:"批量删除成功"}),Y(),i.value=_.value.length>1?i.value:i.value-1},e=>{m({type:"error",message:"批量删除失败 "+e})})},W=async a=>{a&&await a.validate(async e=>{e?Se(n).then(()=>{u.value=!1,m({type:"success",message:n.objectId?"更新成功":"添加成功"}),window.location.reload()},d=>{u.value=!1,m({type:"error",message:n!=null&&n.objectId?"更新失败 "+d:"添加失败 "+d})}):m({type:"error",message:"表单校验失败"})})};let w=v("");const X=async a=>{await Me("username",a).then(e=>{_.value=e.map(d=>({...d.attributes,objectId:d.id,createdAt:h(d.createdAt).format("YYYY-MM-DD HH:mm:ss"),updatedAt:h(d.updatedAt).format("YYYY-MM-DD HH:mm:ss")}))})},Z=async a=>{X(a)};let k=xe();const R=()=>{k.setRefresh(!k.refresh)};return(a,e)=>{const d=be,p=ve,b=fe,S=ge,M=_e,c=ye,F=we,ee=he,ae=Ie,te=Ye,le=Ve,oe=Ue,U=de("has");return f(),H("div",null,[t(M,{style:{height:"80px"}},{default:o(()=>[t(S,{inline:!0,class:"form"},{default:o(()=>[t(p,{label:"账号搜索"},{default:o(()=>[t(d,{placeholder:"请输入搜索关键字",modelValue:s(w),"onUpdate:modelValue":e[0]||(e[0]=l=>V(w)?w.value=l:w=l)},null,8,["modelValue"])]),_:1}),t(p,null,{default:o(()=>[t(b,{type:"primary",disabled:!s(w),onClick:e[1]||(e[1]=l=>Z(s(w)))},{default:o(()=>[g(" 搜索 ")]),_:1},8,["disabled"]),t(b,{type:"primary",onClick:R},{default:o(()=>[g("重置")]),_:1})]),_:1})]),_:1})]),_:1}),t(M,{style:{margin:"10px 0px"}},{default:o(()=>[C((f(),I(b,{type:"primary",onClick:K},{default:o(()=>[g(" 添加账号 ")]),_:1})),[[U,"btn.user.add"]]),C((f(),I(b,{type:"primary",onClick:J,disabled:!s(A).length},{default:o(()=>[g(" 批量删除 ")]),_:1},8,["disabled"])),[[U,"btn.user.removeSelect"]]),t(ee,{style:{margin:"10px 0px"},border:"",data:N.value,onSelectionChange:$},{default:o(()=>[t(c,{type:"selection",align:"center",fixed:"left"}),t(c,{label:"#",align:"center",type:"index"}),t(c,{label:"ID",align:"center",prop:"objectId","show-overflow-tooltip":""}),t(c,{label:"账号",align:"center",prop:"username","show-overflow-tooltip":""}),t(c,{label:"昵称",align:"center",prop:"shortId","show-overflow-tooltip":""}),t(c,{label:"角色",align:"center",prop:"role","show-overflow-tooltip":""}),t(c,{label:"邮箱",align:"center",prop:"email","show-overflow-tooltip":""}),t(c,{label:"手机号",align:"center",prop:"mobilePhoneNumber","show-overflow-tooltip":""}),t(c,{label:"创建时间",align:"center",prop:"createdAt","show-overflow-tooltip":""}),t(c,{label:"更新时间",align:"center",prop:"updatedAt","show-overflow-tooltip":""}),t(c,{label:"操作",width:"160px",align:"center",fixed:"right"},{default:o(({row:l})=>[C((f(),I(b,{type:"primary",size:"small",onClick:re=>Q(l),disabled:j(l.objectId)},{default:o(()=>[g(" 编辑 ")]),_:2},1032,["onClick","disabled"])),[[U,"btn.user.edit"]]),t(F,{title:`确认删除 ${l.username}?`,width:"200px",onConfirm:re=>G(l.objectId)},{reference:o(()=>[C((f(),I(b,{type:"primary",size:"small",disabled:j(l.objectId)},{default:o(()=>[g(" 删除 ")]),_:2},1032,["disabled"])),[[U,"btn.user.remove"]])]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"]),t(ae,{"current-page":s(i),"onUpdate:currentPage":e[2]||(e[2]=l=>V(i)?i.value=l:i=l),"page-size":s(y),"onUpdate:pageSize":e[3]||(e[3]=l=>V(y)?y.value=l:y=l),"page-sizes":[10,20,50],layout:"prev, pager, next, jumper,->,sizes,total",total:s(P),background:"",onCurrentChange:O,onSizeChange:L},null,8,["current-page","page-size","total"])]),_:1}),t(oe,{modelValue:s(u),"onUpdate:modelValue":e[10]||(e[10]=l=>V(u)?u.value=l:u=l)},{header:o(()=>[q("h4",null,ue(s(n).objectId?"更新账号":"添加账号"),1)]),default:o(()=>[t(S,{model:s(n),rules:T,ref_key:"userFormRef",ref:r},{default:o(()=>[t(p,{label:"账号",prop:"username"},{default:o(()=>[t(d,{placeholder:"账号",modelValue:s(n).username,"onUpdate:modelValue":e[4]||(e[4]=l=>s(n).username=l),clearable:""},null,8,["modelValue"])]),_:1}),s(n).objectId?ie("",!0):(f(),I(p,{key:0,label:"密码",prop:"password"},{default:o(()=>[t(d,{placeholder:"密码",modelValue:s(n).password,"onUpdate:modelValue":e[5]||(e[5]=l=>s(n).password=l)},null,8,["modelValue"])]),_:1})),t(p,{label:"昵称",prop:"shortId"},{default:o(()=>[t(d,{placeholder:"昵称",modelValue:s(n).shortId,"onUpdate:modelValue":e[6]||(e[6]=l=>s(n).shortId=l),clearable:""},null,8,["modelValue"])]),_:1}),t(p,{label:"角色",prop:"role"},{default:o(()=>[t(le,{modelValue:s(n).role,"onUpdate:modelValue":e[7]||(e[7]=l=>s(n).role=l),placeholder:"角色"},{default:o(()=>[(f(!0),H(pe,null,ce(s(x),l=>(f(),I(te,{key:l.name,label:l.name,value:l.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),footer:o(()=>[q("div",qe,[t(b,{type:"primary",onClick:e[8]||(e[8]=l=>W(s(r)))},{default:o(()=>[g(" 确定 ")]),_:1}),t(b,{onClick:e[9]||(e[9]=l=>V(u)?u.value=!1:u=!1)},{default:o(()=>[g("取消")]),_:1})])]),_:1},8,["modelValue"])])}}}),Je=Ae(Be,[["__scopeId","data-v-426ab258"]]);export{Je as default};
